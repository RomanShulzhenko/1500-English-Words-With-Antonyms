<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>1500 English words with antonyms</title>
<style>
  :root{
    --bg:#eaf7ea;
    --text:#2f4f2f;
    --accent:#4CAF50;
    --accent-dark:#1a4d1a;
    --card:#ffffff;
  }
  body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:18px;}
  .wrap{max-width:920px;margin:0 auto;}
  .header{ text-align:center; margin-bottom:12px;}
  .header img{max-width:100%;height:auto;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h1{color:var(--accent-dark);text-align:center;margin:8px 0 14px;font-size:20px;}
  .controls{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap}
  .search{flex:1;min-width:200px;max-width:520px}
  input[type="search"]{width:100%;padding:10px;border-radius:10px;border:2px solid rgba(0,0,0,0.06);font-size:15px}
  .nav{display:flex;gap:8px;align-items:center}
  button{background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  button.secondary{background:#fff;color:var(--accent);border:2px solid var(--accent)}
  .card{background:var(--card);border:2px solid var(--accent);border-radius:14px;padding:18px;margin:6px 0;box-shadow:0 4px 12px rgba(0,0,0,0.04)}
  .word-title{font-size:34px;font-weight:800;color:var(--accent-dark);margin-bottom:8px}
  .meta{color:#3b6b3b;margin-bottom:8px}
  .antonyms{color:#006400;font-weight:600}
  .footer{font-size:13px;color:#3b6b3b;text-align:center;margin-top:14px}
  .count{font-size:13px;color:#235023;margin-left:8px}
  /* список (overlay) */
  .overlay{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(10,20,10,0.45);display:none;align-items:flex-start;justify-content:center;padding:24px;box-sizing:border-box;z-index:80}
  .panel{background:#fff;border-radius:12px;padding:14px;max-width:920px;width:100%;max-height:86vh;overflow:auto}
  .panel h3{margin:0 0 8px}
  .word-mini{padding:8px;border-bottom:1px solid #f0f0f0;cursor:pointer}
  .word-mini:hover{background:#f6fff6}
  @media(max-width:560px){ .word-title{font-size:26px} .controls{gap:6px} button{padding:8px 10px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <!-- Поменяйте файл header.png на ваш баннер (положите рядом с index.html) -->
      <img id="banner" src="header.png" alt="Banner">
    </div>

    <h1>1500 English words with antonyms</h1>

    <div class="controls">
      <div class="search">
        <input id="search" type="search" placeholder="Поиск слова (введите английское слово и нажмите Enter)">
      </div>

      <div class="nav">
        <button id="prev">← Назад</button>
        <button id="next">Вперёд →</button>
        <button id="random" class="secondary">Случайное</button>
        <button id="list" class="secondary">Список</button>
        <span class="count" id="pos">0 / 0</span>
      </div>
    </div>

    <div class="card" id="card">
      <div class="word-title" id="word">Loading…</div>
      <div class="meta" id="meaning"></div>
      <div class="antonyms" id="antonyms"></div>
    </div>

    <div class="footer">
      Если JSON находится в отдельном файле — положите его в корень репозитория как <code>words_full_rus.json</code>.
    </div>
  </div>

  <!-- Overlay: список всех слов -->
  <div id="overlay" class="overlay">
    <div class="panel">
      <h3>Выберите слово</h3>
      <div id="list-all"></div>
      <div style="text-align:right;margin-top:8px">
        <button id="close-list" class="secondary">Закрыть</button>
      </div>
    </div>
  </div>

<script>
/* ==== Загрузка данных: попробуем несколько вариантов файла ====
   Если в репозитории вы положили words_full_rus.json — он будет загружен.
   Если нет — используем встроенный пример (чтобы интерфейс был доступен).
*/
const TRY_FILES = ['words_full_rus.json','words_rus.json','words.json'];

const fallback = [
  {"Слово":"Alive","Антонимы":["Unconscious","Sluggish","Deceased","Dead"],"Значение":null},
  {"Слово":"Abundant","Антонимы":["Lacking","Sparse","Meager","Scarce"],"Значение":"Plentiful, ample"},
  {"Слово":"Advance","Антонимы":["Retire","Behind","Later","Retreat"],"Значение":"Progress, improvement"},
  {"Слово":"Strong","Антонимы":["Weak","Idle","Intermittent"],"Значение":"Powerful, sturdy"}
];

let data = []; // массив записей
let idx = 0;

function toArray(x){
  if(!x) return [];
  if(Array.isArray(x)) return x;
  if(typeof x === 'string') return x.split(',').map(s=>s.trim()).filter(Boolean);
  return [];
}

function normalizeRaw(raw){
  // raw may be array or object mapping
  if(Array.isArray(raw)){
    return raw.map(e=>{
      return {
        "Слово": e["Слово"] || e.word || e["Word"] || '',
        "Антонимы": toArray(e["Антонимы"] || e.antonyms || e["Антоним"] || e["Антонимы"]),
        "Значение": e["Значение"] || e.definition || e.meaning || null
      };
    });
  }
  if(raw && typeof raw === 'object'){
    // check if values are records or mapping word->record
    const keys = Object.keys(raw);
    if(keys.length === 0) return [];
    const firstVal = raw[keys[0]];
    // if firstVal has "Слово" or "Антонимы" assume array-like stored under numeric keys
    if(firstVal && (firstVal["Слово"] || firstVal["Антонимы"] || firstVal.word || firstVal.antonyms)){
      // treat raw as object with numeric keys
      return keys.map(k=>{
        const e = raw[k];
        return {
          "Слово": e["Слово"] || e.word || '',
          "Антонимы": toArray(e["Антонимы"] || e.antonyms || e["Антоним"] || e["Антонимы"]),
          "Значение": e["Значение"] || e.definition || null
        };
      });
    } else {
      // mapping: key = word, value = {Антонимы, Значение}
      return keys.map(k=>{
        const v = raw[k] || {};
        return {
          "Слово": k,
          "Антонимы": toArray(v["Антонимы"] || v.antonyms || v["Антоним"] || v.antonym),
          "Значение": v["Значение"] || v.definition || null
        };
      });
    }
  }
  return [];
}

function tryLoadFiles(list, i=0){
  if(i >= list.length){
    data = normalizeRaw(fallback);
    afterLoad();
    return;
  }
  const url = list[i];
  fetch(url).then(r=>{
    if(!r.ok) throw new Error('not ok');
    return r.json();
  }).then(json=>{
    data = normalizeRaw(json).sort((a,b)=>( (a["Слово"]||'').toLowerCase() < (b["Слово"]||'').toLowerCase() ? -1 : 1 ));
    afterLoad();
  }).catch(err=>{
    tryLoadFiles(list, i+1);
  });
}

function afterLoad(){
  if(!Array.isArray(data) || data.length === 0){
    data = normalizeRaw(fallback);
  }
  // If URL has hash (#Word), jump to it
  const hash = decodeURIComponent(location.hash.slice(1));
  if(hash){
    const ind = data.findIndex(e => (e["Слово"]||'').toLowerCase() === hash.toLowerCase());
    if(ind >= 0) idx = ind;
  }
  renderCurrent();
  prepareList();
}

function renderCurrent(){
  const w = document.getElementById('word');
  const meaningEl = document.getElementById('meaning');
  const ants = document.getElementById('antonyms');
  if(!data || data.length === 0){
    w.textContent = 'Слова нет';
    meaningEl.textContent = '';
    ants.textContent = '';
    document.getElementById('pos').textContent = '0 / 0';
    return;
  }
  const entry = data[idx];
  w.textContent = entry["Слово"] || '';
  meaningEl.innerHTML = entry["Значение"] ? '<b>Значение:</b> ' + entry["Значение"] : '';
  const arr = Array.isArray(entry["Антонимы"]) ? entry["Антонимы"] : toArray(entry["Антонимы"]);
  ants.innerHTML = '<b>Антонимы:</b> ' + (arr.length ? arr.join(', ') : '—');
  document.getElementById('pos').textContent = (idx+1) + ' / ' + data.length;
  // update hash
  location.hash = encodeURIComponent(entry["Слово"] || '');
}

function prev(){
  if(!data || data.length === 0) return;
  idx = (idx - 1 + data.length) % data.length;
  renderCurrent();
}
function next(){
  if(!data || data.length === 0) return;
  idx = (idx + 1) % data.length;
  renderCurrent();
}
function randomShow(){
  if(!data || data.length === 0) return;
  idx = Math.floor(Math.random() * data.length);
  renderCurrent();
}

document.getElementById('prev').addEventListener('click', prev);
document.getElementById('next').addEventListener('click', next);
document.getElementById('random').addEventListener('click', randomShow);

// поиск — на Enter
document.getElementById('search').addEventListener('keydown', (e)=>{
  if(e.key === 'Ente
